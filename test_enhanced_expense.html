<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢å¼ºç‰ˆèŠ±è´¹è®°å½•åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        button { margin: 5px; padding: 10px 15px; }
        .feature-list { list-style-type: none; padding: 0; }
        .feature-list li { padding: 5px 0; }
        .feature-list li:before { content: "âœ… "; color: green; }
    </style>
</head>
<body>
    <h1>ğŸ§ª å¢å¼ºç‰ˆèŠ±è´¹è®°å½•åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>ğŸ†• æ–°å¢åŠŸèƒ½ç‰¹æ€§</h3>
        <ul class="feature-list">
            <li>è¯¦ç»†è´¹ç”¨ä¿¡æ¯è¾“å…¥ï¼ˆæ—¶é—´ã€åœ°ç‚¹ã€äººæ•°ç­‰ï¼‰</li>
            <li>å­ç±»åˆ«åˆ†ç±»ç³»ç»Ÿ</li>
            <li>æŒ‰æ—¥æœŸåˆ†ç»„æ˜¾ç¤º</li>
            <li>ç­›é€‰å’Œæ’åºåŠŸèƒ½</li>
            <li>å¿…è¦/éå¿…è¦æ”¯å‡ºæ ‡è®°</li>
            <li>äººå‡è´¹ç”¨è®¡ç®—</li>
            <li>åˆ—è¡¨/åˆ†ç»„è§†å›¾åˆ‡æ¢</li>
            <li>å¢å¼ºçš„ç¼–è¾‘åŠŸèƒ½</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h3>ğŸ“Š åŠŸèƒ½æµ‹è¯•</h3>
        <button onclick="addDetailedTestData()">æ·»åŠ è¯¦ç»†æµ‹è¯•æ•°æ®</button>
        <button onclick="testSubcategories()">æµ‹è¯•å­ç±»åˆ«åŠŸèƒ½</button>
        <button onclick="testFiltering()">æµ‹è¯•ç­›é€‰åŠŸèƒ½</button>
        <button onclick="openEnhancedExpensePage()">æ‰“å¼€å¢å¼ºç‰ˆèŠ±è´¹è®°å½•é¡µé¢</button>
        <div id="test-results"></div>
    </div>
    
    <div class="test-section">
        <h3>ğŸ”— å¿«é€Ÿé“¾æ¥</h3>
        <a href="github_pages/expense.html" target="_blank">å¢å¼ºç‰ˆèŠ±è´¹è®°å½•é¡µé¢</a> |
        <a href="github_pages/budget.html" target="_blank">é¢„ç®—è®¡ç®—</a> |
        <a href="github_pages/index.html" target="_blank">é¦–é¡µ</a>
    </div>
    
    <div class="test-section">
        <h3>ğŸ“ æµ‹è¯•æ•°æ®ç®¡ç†</h3>
        <button onclick="clearAllTestData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
        <button onclick="exportTestData()">å¯¼å‡ºæµ‹è¯•æ•°æ®</button>
        <div id="data-status"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('test-results');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            results.innerHTML += `<div class="${className}">${new Date().toLocaleTimeString()}: ${message}</div>`;
        }

        function addDetailedTestData() {
            const detailedTestData = [
                {
                    id: Date.now() + '1',
                    date: '2024-01-01',
                    time: '08:30',
                    category: 'é¤é¥®',
                    subcategory: 'æ—©é¤',
                    title: 'é…’åº—è‡ªåŠ©æ—©é¤',
                    amount: 68,
                    people: 2,
                    location: 'å¤§ç†å¤åŸå¸Œå°”é¡¿é…’åº—',
                    note: 'å“ç§ä¸°å¯Œï¼Œæ€§ä»·æ¯”ä¸é”™',
                    necessary: true
                },
                {
                    id: Date.now() + '2',
                    date: '2024-01-01',
                    time: '14:30',
                    category: 'é—¨ç¥¨',
                    subcategory: 'æ™¯ç‚¹é—¨ç¥¨',
                    title: 'å¤§ç†å¤åŸé—¨ç¥¨',
                    amount: 120,
                    people: 2,
                    location: 'å¤§ç†å¤åŸ',
                    note: 'åŒ…å«å¯¼æ¸¸è®²è§£',
                    necessary: true
                },
                {
                    id: Date.now() + '3',
                    date: '2024-01-01',
                    time: '18:00',
                    category: 'é¤é¥®',
                    subcategory: 'æ™šé¤',
                    title: 'ç™½æ—ç‰¹è‰²èœ',
                    amount: 180,
                    people: 2,
                    location: 'å¤§ç†å¤åŸå†…',
                    note: 'é…¸è¾£é±¼å¾ˆå¥½åƒï¼Œæ¨è',
                    necessary: true
                },
                {
                    id: Date.now() + '4',
                    date: '2024-01-02',
                    time: '10:00',
                    category: 'äº¤é€š',
                    subcategory: 'å‡ºç§Ÿè½¦',
                    title: 'å‰å¾€æ´±æµ·',
                    amount: 45,
                    people: 2,
                    location: 'å¤§ç†',
                    note: 'å¸ˆå‚…å¾ˆçƒ­æƒ…ï¼Œä»‹ç»äº†å¾ˆå¤šæ™¯ç‚¹',
                    necessary: true
                },
                {
                    id: Date.now() + '5',
                    date: '2024-01-02',
                    time: '15:30',
                    category: 'è´­ç‰©',
                    subcategory: 'çºªå¿µå“',
                    title: 'å¤§ç†çŸ³å·¥è‰ºå“',
                    amount: 280,
                    people: 1,
                    location: 'åŒå»Šé•‡',
                    note: 'é€ç»™æœ‹å‹çš„ç¤¼ç‰©',
                    necessary: false
                },
                {
                    id: Date.now() + '6',
                    date: '2024-01-03',
                    time: '09:15',
                    category: 'ä½å®¿',
                    subcategory: 'æ°‘å®¿',
                    title: 'æ´±æµ·è¾¹æ°‘å®¿',
                    amount: 320,
                    people: 2,
                    location: 'åŒå»Šé•‡',
                    note: 'æµ·æ™¯æˆ¿ï¼Œé£æ™¯å¾ˆç¾',
                    necessary: true
                }
            ];
            
            localStorage.setItem('travelExpenses', JSON.stringify(detailedTestData));
            
            // æ·»åŠ é¢„ç®—æ•°æ®
            const budgetData = {
                'ä½å®¿': 2000,
                'é¤é¥®': 1500,
                'äº¤é€š': 800,
                'é—¨ç¥¨': 600,
                'è´­ç‰©': 400,
                'å…¶ä»–': 300,
                'æ€»è®¡': 5600,
                'äººå‡': 2800,
                'é¢„ç®—ç­‰çº§': 'ä¸­ç­‰'
            };
            localStorage.setItem('lastBudgetResult', JSON.stringify(budgetData));
            
            document.getElementById('data-status').innerHTML = 
                '<div class="success">âœ… å·²æ·»åŠ 6æ¡è¯¦ç»†æµ‹è¯•æ•°æ®å’Œé¢„ç®—ä¿¡æ¯</div>';
            log('âœ… è¯¦ç»†æµ‹è¯•æ•°æ®æ·»åŠ æˆåŠŸ', 'success');
        }

        function testSubcategories() {
            const subcategories = {
                'ä½å®¿': ['é…’åº—', 'æ°‘å®¿', 'é’æ—…', 'å®¢æ ˆ', 'åº¦å‡æ‘'],
                'é¤é¥®': ['æ—©é¤', 'åˆé¤', 'æ™šé¤', 'å°é£Ÿ', 'é¥®å“', 'ç‰¹è‰²ç¾é£Ÿ'],
                'äº¤é€š': ['é£æœº', 'ç«è½¦', 'æ±½è½¦', 'å‡ºç§Ÿè½¦', 'å…¬äº¤', 'åœ°é“', 'èˆ¹ç¥¨', 'ç§Ÿè½¦'],
                'é—¨ç¥¨': ['æ™¯ç‚¹é—¨ç¥¨', 'æ¼”å‡ºç¥¨', 'ä½“éªŒé¡¹ç›®', 'å¯¼æ¸¸è´¹', 'åœè½¦è´¹'],
                'è´­ç‰©': ['çºªå¿µå“', 'ç‰¹äº§', 'æœè£…', 'æ—¥ç”¨å“', 'è¯å“'],
                'å…¶ä»–': ['ä¿é™©', 'å°è´¹', 'é€šè®¯', 'ç´§æ€¥æ”¯å‡º', 'æ‚è´¹']
            };
            
            let testPassed = true;
            for (const [category, subs] of Object.entries(subcategories)) {
                if (!subs || subs.length === 0) {
                    testPassed = false;
                    break;
                }
            }
            
            if (testPassed) {
                log('âœ… å­ç±»åˆ«ç³»ç»Ÿæµ‹è¯•é€šè¿‡', 'success');
            } else {
                log('âŒ å­ç±»åˆ«ç³»ç»Ÿæµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testFiltering() {
            const expenses = JSON.parse(localStorage.getItem('travelExpenses') || '[]');
            
            if (expenses.length === 0) {
                log('âš ï¸ è¯·å…ˆæ·»åŠ æµ‹è¯•æ•°æ®', 'error');
                return;
            }
            
            // æµ‹è¯•æŒ‰ç±»åˆ«ç­›é€‰
            const diningExpenses = expenses.filter(e => e.category === 'é¤é¥®');
            log(`ğŸ“Š é¤é¥®ç±»æ”¯å‡º: ${diningExpenses.length} æ¡`, 'info');
            
            // æµ‹è¯•æŒ‰æ—¥æœŸç­›é€‰
            const day1Expenses = expenses.filter(e => e.date === '2024-01-01');
            log(`ğŸ“… 2024-01-01 æ”¯å‡º: ${day1Expenses.length} æ¡`, 'info');
            
            // æµ‹è¯•å¿…è¦æ”¯å‡ºç­›é€‰
            const necessaryExpenses = expenses.filter(e => e.necessary);
            log(`â­ å¿…è¦æ”¯å‡º: ${necessaryExpenses.length} æ¡`, 'info');
            
            log('âœ… ç­›é€‰åŠŸèƒ½æµ‹è¯•å®Œæˆ', 'success');
        }

        function openEnhancedExpensePage() {
            window.open('github_pages/expense.html', '_blank');
            log('ğŸ”— å·²æ‰“å¼€å¢å¼ºç‰ˆèŠ±è´¹è®°å½•é¡µé¢', 'info');
        }

        function clearAllTestData() {
            localStorage.removeItem('travelExpenses');
            localStorage.removeItem('lastBudgetResult');
            document.getElementById('data-status').innerHTML = 
                '<div class="error">ğŸ—‘ï¸ å·²æ¸…é™¤æ‰€æœ‰æµ‹è¯•æ•°æ®</div>';
            log('ğŸ—‘ï¸ æµ‹è¯•æ•°æ®æ¸…é™¤æˆåŠŸ', 'info');
        }

        function exportTestData() {
            const expenses = localStorage.getItem('travelExpenses');
            const budget = localStorage.getItem('lastBudgetResult');
            
            if (!expenses) {
                log('âš ï¸ æ²¡æœ‰æ•°æ®å¯å¯¼å‡º', 'error');
                return;
            }
            
            const data = {
                expenses: JSON.parse(expenses),
                budget: budget ? JSON.parse(budget) : null,
                exportTime: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `enhanced-expense-test-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            log('ğŸ“¤ æµ‹è¯•æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            log('ğŸš€ å¼€å§‹å¢å¼ºç‰ˆåŠŸèƒ½æµ‹è¯•...', 'info');
            testSubcategories();
            log('ğŸ“‹ åŸºç¡€æµ‹è¯•å®Œæˆï¼Œè¯·æ‰‹åŠ¨æµ‹è¯•å…¶ä»–åŠŸèƒ½', 'info');
        };
    </script>
</body>
</html>
